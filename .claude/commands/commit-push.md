# 커밋 → 푸시 → PR 생성

작업 완료 후 변경사항을 커밋하고, 푸시하고, PR을 생성합니다.

**중요**: 이 명령어는 커밋, 푸시, PR 생성까지 수행합니다. 머지는 사용자가 직접 GitHub에서 진행합니다.

**전제 조건**: 이슈와 브랜치가 이미 생성되어 있어야 합니다. 없다면 `/create-issue` 명령어를 먼저 사용하세요.

## 📌 컨벤션 참고
- 커밋: `docs/conventions.md` (커밋 컨벤션)
- **PR 템플릿**: `.github/PULL_REQUEST_TEMPLATE.md` (반드시 따를 것)

---

## 🔄 작업 순서

### Step 0: 사전 확인

현재 브랜치 확인:
```bash
git branch --show-current
```

**확인 사항**:
- develop 또는 main 브랜치가 아닌지 확인
- 이슈 번호가 브랜치명에 포함되어 있는지 확인 (예: `feature/123--login-ui`)

만약 develop/main 브랜치라면:
- "현재 develop/main 브랜치입니다. `/create-issue` 명령어로 이슈와 브랜치를 먼저 생성하세요."

### Step 1: 변경사항 분석

다음 명령어들을 **병렬로** 실행:
```bash
git status
git diff
git log -5 --oneline
```

변경사항을 분석하여:
- 작업 타입 파악 (feature/fix/refactor/docs/chore 등)
- 무엇을 변경했는지 파악
- 왜 변경했는지 파악

브랜치명에서 이슈 번호 추출 (예: `feature/123--login-ui` → #123)

### Step 2: 커밋 메시지 작성

**커밋 컨벤션**: `타입: 한글 내용(#이슈번호)`

커밋 타입:
- feat, fix, refactor, design, style, test, chore, init, rename, remove, docs

예시: `feat: 로그인 ui 작업(#32)`

**사용자에게 커밋 메시지 확인**:
- "다음 내용으로 커밋하시겠습니까?"
- 커밋 메시지 표시

### Step 3: 파일 스테이징 및 커밋

**중요**: 민감한 파일 제외
- `.env`, `credentials.json`, `.DS_Store` 등 제외 확인

관련 파일만 스테이징:
```bash
git add [파일들]
```

커밋 생성:
```bash
git commit -m "타입: 한글 내용(#이슈번호)"
```

커밋 후 상태 확인:
```bash
git status
```

### Step 4: 원격 저장소에 푸시

**사용자에게 푸시 확인**:
- "원격 저장소에 푸시하시겠습니까?"

첫 푸시인 경우 `-u` 플래그 사용:
```bash
git push -u origin 브랜치명
```

이후 푸시:
```bash
git push
```

### Step 5: PR 생성

푸시가 성공적으로 완료되면 PR을 생성합니다.

**기존 PR 확인**:
```bash
gh pr list --head 브랜치명 --state open
```

기존 PR이 있으면 PR 생성 건너뛰기.

기존 PR이 없으면:

**중요**: `.github/PULL_REQUEST_TEMPLATE.md` 파일을 반드시 읽고 해당 형식을 따를 것!

**사용자에게 PR 생성 확인**:
- "PR을 생성하시겠습니까?"

PR 생성 (PR 템플릿 형식 준수):
```bash
gh pr create --base develop --title "타입: 제목(#이슈번호)" --body "$(cat <<'EOF'
## 📌 개요

- PR의 목적과 해결하려는 문제를 간단히 설명

## 🔧 작업 내용

- [ ] 구현/수정한 주요 기능 항목별 정리

## 📎 관련 이슈

Closes #이슈번호

## 📸 스크린샷 (선택)

(필요시 추가)

## 💬 리뷰어 참고 사항

- 리뷰어가 중점적으로 봐주었으면 하는 부분
EOF
)"
```

**이슈 자동 close 키워드 규칙**:
- `Closes #이슈번호` 또는 `Fixes #이슈번호` 형식 사용
- 리스트(`-`) 없이 단독 라인으로 작성
- 이렇게 해야 PR 머지 시 이슈가 자동으로 닫힘

### Step 6: 완료 안내

PR 생성이 완료되면 사용자에게 다음 안내 메시지 표시:

```
✅ PR 생성 완료!

📌 다음 단계:
- 코드 리뷰 및 머지는 직접 진행해주세요

이슈: #[이슈번호]
브랜치: [브랜치명]
PR: [PR URL]
```

**중요**: 머지는 사용자가 직접 GitHub에서 수행합니다.

---

## ⚠️ 주의사항

### 커밋 전 체크리스트
- [ ] `.env`, `credentials.json` 등 민감 파일 제외
- [ ] 불필요한 파일 제외 (node_modules, .DS_Store 등)
- [ ] 커밋 타입이 올바른지 확인
- [ ] 이슈 번호가 포함되었는지 확인
- [ ] 한글로 작성되었는지 확인

### Pre-commit Hook 처리
1. 커밋 실패 시 hook이 파일을 수정했는지 확인
2. 수정된 경우 재커밋 또는 amend

### 금지 사항
- `--no-verify` 플래그 사용 금지 (사용자 명시 요청 시만)
- force push 절대 금지
- main/master에 직접 커밋 금지

---

## 📊 전체 워크플로우 요약

### 🤖 자동화 범위 (이 명령어가 수행)
1. **사전 확인** (브랜치 확인)
2. **변경사항 분석** (git status, git diff)
3. **커밋 메시지 작성** (타입: 내용(#번호))
4. **파일 스테이징** (git add)
5. **커밋** (git commit)
6. **푸시** (git push)
7. **PR 생성** (gh pr create)
8. **완료 안내** (머지 안내)

### 👤 사용자가 직접 수행
9. **코드 리뷰 및 머지**

---

## 💡 사용자 인터랙션

각 단계마다 사용자 확인:
1. (변경사항 분석 후) "다음 내용으로 커밋하시겠습니까?" + 커밋 메시지 표시
2. "원격 저장소에 푸시하시겠습니까?"
3. "PR을 생성하시겠습니까?"
4. (PR 생성 완료 후) "코드 리뷰 및 머지는 직접 진행해주세요" 안내 표시
